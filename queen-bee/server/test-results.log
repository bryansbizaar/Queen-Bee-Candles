
> queen-bee-server@1.0.0 test
> NODE_ENV=test NODE_OPTIONS='--experimental-vm-modules --no-warnings' jest --verbose --no-coverage --detectOpenHandles

  console.log
    🧪 Loading TEST environment for Jest tests

      at tests/setup/env.js:10:11

  console.error
    OrderService.createOrder error: Error: Insufficient stock for product ID 1. Please check availability.
        at Function.createOrder (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/services/OrderService.js:110:17)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at Object.<anonymous> (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/tests/services/OrderService.test.js:227:7)

      118 |     } catch (error) {
      119 |       await client.query("ROLLBACK");
    > 120 |       console.error("OrderService.createOrder error:", error);
          |               ^
      121 |       throw error;
      122 |     } finally {
      123 |       client.release();

      at Function.createOrder (services/OrderService.js:120:15)
      at Object.<anonymous> (tests/services/OrderService.test.js:227:7)

  console.error
    OrderService.createOrder error: error: insert or update on table "order_items" violates foreign key constraint "order_items_product_id_fkey"
        at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/pg/lib/client.js:545:17
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at Function.createOrder (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/services/OrderService.js:86:9)
        at Object.<anonymous> (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/tests/services/OrderService.test.js:255:7) {
      length: 280,
      severity: 'ERROR',
      code: '23503',
      detail: 'Key (product_id)=(999) is not present in table "products".',
      hint: undefined,
      position: undefined,
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: 'public',
      table: 'order_items',
      column: undefined,
      dataType: undefined,
      constraint: 'order_items_product_id_fkey',
      file: 'ri_triggers.c',
      line: '2539',
      routine: 'ri_ReportViolation'
    }

      118 |     } catch (error) {
      119 |       await client.query("ROLLBACK");
    > 120 |       console.error("OrderService.createOrder error:", error);
          |               ^
      121 |       throw error;
      122 |     } finally {
      123 |       client.release();

      at Function.createOrder (services/OrderService.js:120:15)
      at Object.<anonymous> (tests/services/OrderService.test.js:255:7)

PASS tests/services/OrderService.test.js
  OrderService
    createOrder()
      ✓ should create order with single item and update inventory (152 ms)
      ✓ should create order with multiple items (116 ms)
      ✓ should create new customer if they don't exist (134 ms)
      ✓ should throw error for insufficient stock (122 ms)
      ✓ should rollback transaction on failure (115 ms)
      ✓ should generate unique order IDs (126 ms)
    getOrderById()
      ✓ should return complete order details (109 ms)
      ✓ should return null for non-existent order (108 ms)
    getOrdersByCustomer()
      ✓ should return all orders for customer (111 ms)
      ✓ should return empty array for customer with no orders (109 ms)
    updateOrderStatus()
      ✓ should update order status successfully (109 ms)
      ✓ should throw error for non-existent order (106 ms)
    getAllOrders()
      ✓ should return all orders with default pagination (112 ms)
      ✓ should respect limit parameter (110 ms)
      ✓ should respect offset parameter (112 ms)
      ✓ should filter by status (111 ms)
    getOrderByPaymentIntent()
      ✓ should return order for existing payment intent (109 ms)
      ✓ should return null for non-existent payment intent (106 ms)
    getOrderStats()
      ✓ should return comprehensive order statistics (111 ms)
      ✓ should filter stats by date range (111 ms)
      ✓ should return zero stats for date range with no orders (106 ms)
    Edge Cases and Error Handling
      ✓ should handle concurrent order creation for same customer (117 ms)
      ✓ should handle orders with very large quantities (111 ms)
      ✓ should handle orders with minimal data (111 ms)
      ✓ should maintain referential integrity (109 ms)

  console.log
    🧪 Loading TEST environment for Jest tests

      at tests/setup/env.js:10:11

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:19.034Z',
      level: 'WARN',
      message: 'Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:19.154Z',
      level: 'WARN',
      message: 'Validation failed: Invalid email format',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Invalid email format\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:19.274Z',
      level: 'WARN',
      message: 'Validation failed: Amount must be a positive number',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Amount must be a positive number\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:20.447Z',
      level: 'WARN',
      message: 'Invalid payment intent ID format',
      statusCode: 400,
      method: 'GET',
      url: '/api/stripe/payment-intent/invalid-format',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'BadRequestError: Invalid payment intent ID format\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/routes/stripe.routes.js:267:13\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/errorHandler.js:171:21\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at param (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:365:14)\n' +
        '    at param (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:376:14)\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:421:3)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:94:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at jsonParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/json.js:113:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at cors (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/cors/lib/index.js:188:7)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/cors/lib/index.js:224:17\n' +
        '    at originCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/cors/lib/index.js:214:15)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/cors/lib/index.js:219:13\n' +
        '    at optionsCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/cors/lib/index.js:199:9)\n' +
        '    at corsMiddleware (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/cors/lib/index.js:204:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at expressInit (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/middleware/init.js:40:5)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at query (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/middleware/query.js:45:5)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/application.js:181:10)\n' +
        '    at Server.app (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/express.js:39:9)\n' +
        '    at Server.emit (node:events:517:28)\n' +
        '    at parserOnIncoming (node:_http_server:1130:12)\n' +
        '    at HTTPParser.parserOnHeadersComplete (node:_http_common:119:17)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)

  console.error
    Error retrieving payment intent: StripeInvalidRequestError: No such payment_intent: 'pi_test_nonexistent123'
        at generateV1Error (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/stripe/esm/Error.js:8:20)
        at res.toJSON.then.StripeAPIError.message (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/stripe/esm/RequestSender.js:105:31)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      type: 'StripeInvalidRequestError',
      raw: {
        code: 'resource_missing',
        doc_url: 'https://stripe.com/docs/error-codes/resource-missing',
        message: "No such payment_intent: 'pi_test_nonexistent123'",
        param: 'intent',
        request_log_url: 'https://dashboard.stripe.com/test/logs/req_ECPA8vYK1Ffpa5?t=1752889820',
        type: 'invalid_request_error',
        headers: {
          server: 'nginx',
          date: 'Sat, 19 Jul 2025 01:50:21 GMT',
          'content-type': 'application/json',
          'content-length': '347',
          connection: 'keep-alive',
          'access-control-allow-credentials': 'true',
          'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
          'access-control-allow-origin': '*',
          'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
          'access-control-max-age': '300',
          'cache-control': 'no-cache, no-store',
          'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=ZuSTt9qdRzsu8zcPhQMe5QX4XcH_m6p4dwox1BypyBQZDyc9zXPyRfFhXvmSNVPQ3VWz7TWU3PMasVTR",
          'request-id': 'req_ECPA8vYK1Ffpa5',
          'stripe-version': '2025-06-30.basil',
          vary: 'Origin',
          'x-stripe-priority-routing-enabled': 'true',
          'x-stripe-routing-context-priority-tier': 'api-testmode',
          'x-wc': 'ABGHIJ',
          'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
        },
        statusCode: 404,
        requestId: 'req_ECPA8vYK1Ffpa5'
      },
      rawType: 'invalid_request_error',
      code: 'resource_missing',
      doc_url: 'https://stripe.com/docs/error-codes/resource-missing',
      param: 'intent',
      detail: undefined,
      headers: {
        server: 'nginx',
        date: 'Sat, 19 Jul 2025 01:50:21 GMT',
        'content-type': 'application/json',
        'content-length': '347',
        connection: 'keep-alive',
        'access-control-allow-credentials': 'true',
        'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
        'access-control-allow-origin': '*',
        'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
        'access-control-max-age': '300',
        'cache-control': 'no-cache, no-store',
        'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=ZuSTt9qdRzsu8zcPhQMe5QX4XcH_m6p4dwox1BypyBQZDyc9zXPyRfFhXvmSNVPQ3VWz7TWU3PMasVTR",
        'request-id': 'req_ECPA8vYK1Ffpa5',
        'stripe-version': '2025-06-30.basil',
        vary: 'Origin',
        'x-stripe-priority-routing-enabled': 'true',
        'x-stripe-routing-context-priority-tier': 'api-testmode',
        'x-wc': 'ABGHIJ',
        'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
      },
      requestId: 'req_ECPA8vYK1Ffpa5',
      statusCode: 404,
      userMessage: undefined,
      charge: undefined,
      decline_code: undefined,
      payment_intent: undefined,
      payment_method: undefined,
      payment_method_type: undefined,
      setup_intent: undefined,
      source: undefined
    }

      286 |       });
      287 |     } catch (error) {
    > 288 |       console.error("Error retrieving payment intent:", error);
          |               ^
      289 |       throw new InternalServerError("Failed to retrieve payment intent");
      290 |     }
      291 |   })

      at routes/stripe.routes.js:288:15

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:20.880Z',
      level: 'ERROR',
      message: 'Failed to retrieve payment intent',
      statusCode: 500,
      method: 'GET',
      url: '/api/stripe/payment-intent/pi_test_nonexistent123',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'Error: Failed to retrieve payment intent\n' +
        '    at globalErrorHandler (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/errorHandler.js:144:22)\n' +
        '    at Layer.handle_error (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:71:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:326:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Layer.handle_error (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:67:12)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:326:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:646:15\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:265:14)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:141:14)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:95:5)',
      isOperational: false
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:20.991Z',
      level: 'WARN',
      message: 'Invalid payment intent ID format',
      statusCode: 400,
      method: 'GET',
      url: '/api/stripe/order/invalid-format',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'BadRequestError: Invalid payment intent ID format\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/routes/stripe.routes.js:301:13\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/errorHandler.js:171:21\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at param (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:365:14)\n' +
        '    at param (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:376:14)\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:421:3)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:94:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at jsonParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/json.js:113:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at cors (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/cors/lib/index.js:188:7)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/cors/lib/index.js:224:17\n' +
        '    at originCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/cors/lib/index.js:214:15)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/cors/lib/index.js:219:13\n' +
        '    at optionsCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/cors/lib/index.js:199:9)\n' +
        '    at corsMiddleware (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/cors/lib/index.js:204:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at expressInit (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/middleware/init.js:40:5)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at query (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/middleware/query.js:45:5)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/application.js:181:10)\n' +
        '    at Server.app (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/express.js:39:9)\n' +
        '    at Server.emit (node:events:517:28)\n' +
        '    at parserOnIncoming (node:_http_server:1130:12)\n' +
        '    at HTTPParser.parserOnHeadersComplete (node:_http_common:119:17)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    Error retrieving order: BadRequestError: No order found for this payment intent
        at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/routes/stripe.routes.js:309:15
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 400,
      status: 'fail',
      isOperational: true
    }

      315 |       });
      316 |     } catch (error) {
    > 317 |       console.error("Error retrieving order:", error);
          |               ^
      318 |
      319 |       if (error instanceof BadRequestError) {
      320 |         throw error;

      at routes/stripe.routes.js:317:15

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:21.110Z',
      level: 'WARN',
      message: 'No order found for this payment intent',
      statusCode: 400,
      method: 'GET',
      url: '/api/stripe/order/pi_test_nonexistent123',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'BadRequestError: No order found for this payment intent\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/routes/stripe.routes.js:309:15\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:95:5)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:21.222Z',
      level: 'WARN',
      message: 'Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:21.240Z',
      level: 'WARN',
      message: 'Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:21.253Z',
      level: 'WARN',
      message: 'Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:21.270Z',
      level: 'WARN',
      message: 'Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:21.386Z',
      level: 'WARN',
      message: 'Validation failed: Invalid email format',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Invalid email format\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:21.401Z',
      level: 'WARN',
      message: 'Validation failed: Invalid email format',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Invalid email format\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:21.414Z',
      level: 'WARN',
      message: 'Validation failed: Invalid email format',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Invalid email format\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:21.528Z',
      level: 'WARN',
      message: 'Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:21.543Z',
      level: 'WARN',
      message: 'Validation failed: Amount must be a positive number',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Amount must be a positive number\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:21.558Z',
      level: 'WARN',
      message: 'Validation failed: Amount must be a positive number',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Amount must be a positive number\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:21.572Z',
      level: 'WARN',
      message: 'Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems',
      statusCode: 400,
      method: 'POST',
      url: '/api/stripe/create-payment-intent',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'ValidationError: Validation failed: Missing required fields: amount, orderId, customerEmail, cartItems\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/validation.js:18:15\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/security.js:74:14\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:149:13)\n' +
        '    at Route.dispatch (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:284:15\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Function.handle (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:175:3)\n' +
        '    at router (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at urlencodedParser (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n' +
        '    at Layer.handle [as handle_request] (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:95:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:328:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/body-parser/lib/read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)\n' +
        '    at invokeCallback (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:238:16)\n' +
        '    at done (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/raw-body/index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:517:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1400:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at next (node_modules/express/lib/router/route.js:147:13)
      at middleware/validation.js:23:7
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware/security.js:74:14
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:85:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

PASS tests/api/stripe.test.js (6.367 s)
  Stripe API Endpoints
    POST /api/stripe/create-payment-intent
      ✓ should create payment intent with valid data (747 ms)
      ✓ should return 400 for missing required fields (124 ms)
      ✓ should return 400 for invalid email format (120 ms)
      ✓ should return 400 for invalid amount (114 ms)
      ✓ should handle large orders correctly (504 ms)
    POST /api/stripe/create-order
      ✓ should return 400 for invalid payment intent ID format (110 ms)
      ✓ should return 400 for invalid email format (111 ms)
      ✓ should return 400 for empty cart items (111 ms)
      ✓ should validate cart item structure (112 ms)
      ✓ should handle cart items with negative quantity (110 ms)
    GET /api/stripe/payment-intent/:paymentIntentId
      ✓ should return 400 for invalid payment intent ID format (114 ms)
      ✓ should handle non-existent payment intent (429 ms)
    GET /api/stripe/order/:paymentIntentId
      ✓ should return 400 for invalid payment intent ID format (112 ms)
      ✓ should return 400 for non-existent order (118 ms)
    Validation Tests
      ✓ should validate required fields for payment intent creation (164 ms)
      ✓ should validate email formats (142 ms)
      ✓ should validate amount values (158 ms)
    Performance Tests
      ✓ should create payment intent within reasonable time (666 ms)
      ✓ should handle multiple payment intent requests (593 ms)
    Integration with Queen Bee Products
      ✓ should create payment intents for all Queen Bee products (635 ms)
      ✓ should handle high-value Dragon candle orders (486 ms)

  console.log
    🧪 Loading TEST environment for Jest tests

      at tests/setup/env.js:10:11

PASS tests/api/orders.test.js
  Order API Endpoints - Validation Tests
    POST /api/orders - Input Validation
      ✓ should return 400 for missing required fields (149 ms)
      ✓ should return 400 for invalid email format (111 ms)
      ✓ should return 400 for empty items array (112 ms)
      ✓ should return 400 for missing payment intent (111 ms)
      ✓ should return 400 for missing total amount (110 ms)
      ✓ should validate item structure (111 ms)
      ✓ should reject negative quantities (110 ms)
      ✓ should reject zero prices (110 ms)
    GET /api/orders/:id - ID Validation
      ✓ should return 400 for invalid order ID (109 ms)
      ✓ should return 404 for non-existent order (117 ms)
      ✓ should return 400 for negative order ID (109 ms)
    GET /api/orders/customer/:email - Email Validation
      ✓ should return empty array for customer with no orders (114 ms)
      ✓ should return 400 for invalid email format (110 ms)
      ✓ should handle special characters in email (112 ms)
    GET /api/orders/payment-intent/:paymentIntentId - Payment Intent Validation
      ✓ should return 404 for non-existent payment intent (110 ms)
      ✓ should handle invalid payment intent format (113 ms)
    GET /api/orders - Pagination Validation
      ✓ should return orders with default pagination (116 ms)
      ✓ should return 400 for invalid limit (109 ms)
      ✓ should return 400 for negative offset (110 ms)
      ✓ should return 400 for non-numeric limit (109 ms)
      ✓ should handle valid limit and offset (112 ms)
    API Response Structure
      ✓ should return consistent error format (112 ms)
      ✓ should return consistent success format for GET requests (111 ms)
    Performance and Reliability
      ✓ should respond quickly to validation requests (111 ms)
      ✓ should handle multiple validation requests (138 ms)
    Queen Bee Business Logic
      ✓ should pass validation for valid Queen Bee product structure (129 ms)
      ✓ should handle Queen Bee pricing structure validation (162 ms)

  console.log
    🧪 Loading TEST environment for Jest tests

      at tests/setup/env.js:10:11

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:28.735Z',
      level: 'WARN',
      message: 'Product not found',
      statusCode: 404,
      method: 'GET',
      url: '/api/products/999',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'NotFoundError: Product not found\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/controllers/product.controller.js:136:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:95:5)',
      isOperational: true
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)

  console.error
    ❌ Database query error: error: invalid input syntax for type integer: "NaN"
        at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/pg-pool/index.js:45:11
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at query (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/config/database.js:34:17)
        at Function.getProductById (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/services/productService.js:20:22)
        at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/controllers/product.controller.js:133:21 {
      length: 141,
      severity: 'ERROR',
      code: '22P02',
      detail: undefined,
      hint: undefined,
      position: undefined,
      internalPosition: undefined,
      internalQuery: undefined,
      where: "unnamed portal parameter $1 = '...'",
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'numutils.c',
      line: '323',
      routine: 'pg_strtoint32'
    }

      37 |     return res;
      38 |   } catch (error) {
    > 39 |     console.error("❌ Database query error:", error);
         |             ^
      40 |     throw error;
      41 |   }
      42 | };

      at query (config/database.js:39:13)
      at Function.getProductById (services/productService.js:20:22)
      at controllers/product.controller.js:133:21

  console.error
    Error fetching product by ID: error: invalid input syntax for type integer: "NaN"
        at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/pg-pool/index.js:45:11
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at query (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/config/database.js:34:17)
        at Function.getProductById (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/services/productService.js:20:22)
        at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/controllers/product.controller.js:133:21 {
      length: 141,
      severity: 'ERROR',
      code: '22P02',
      detail: undefined,
      hint: undefined,
      position: undefined,
      internalPosition: undefined,
      internalQuery: undefined,
      where: "unnamed portal parameter $1 = '...'",
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'numutils.c',
      line: '323',
      routine: 'pg_strtoint32'
    }

      29 |       return result.rows[0];
      30 |     } catch (error) {
    > 31 |       console.error("Error fetching product by ID:", error);
         |               ^
      32 |       throw new Error("Failed to fetch product");
      33 |     }
      34 |   }

      at Function.getProductById (services/productService.js:31:15)
      at controllers/product.controller.js:133:21

  console.error
    🚨 Error Details: {
      timestamp: '2025-07-19T01:50:28.853Z',
      level: 'ERROR',
      message: 'Failed to retrieve product',
      statusCode: 500,
      method: 'GET',
      url: '/api/products/invalid-id',
      ip: '::ffff:127.0.0.1',
      userAgent: 'Unknown',
      stack: 'Error: Failed to retrieve product\n' +
        '    at globalErrorHandler (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/middleware/errorHandler.js:144:22)\n' +
        '    at Layer.handle_error (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:71:5)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:326:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at Layer.handle_error (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/layer.js:67:12)\n' +
        '    at trim_prefix (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:326:13)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:286:9\n' +
        '    at Function.process_params (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:346:12)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:280:10)\n' +
        '    at /Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:646:15\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/index.js:265:14)\n' +
        '    at next (/Users/bryanowens/Code/Websites/Candles/queen-bee/server/node_modules/express/lib/router/route.js:141:14)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:95:5)',
      isOperational: false
    }

      35 |   } else {
      36 |     // Development: Full error details
    > 37 |     console.error("🚨 Error Details:", errorLog);
         |             ^
      38 |   }
      39 | };
      40 |

      at logError (middleware/errorHandler.js:37:13)
      at globalErrorHandler (middleware/errorHandler.js:154:3)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)

PASS tests/api/products.test.js
  Product API Endpoints
    GET /api/products
      ✓ should return all active products with correct structure (137 ms)
      ✓ should return products with Queen Bee data (115 ms)
      ✓ should handle pagination parameters (150 ms)
      ✓ should filter by category (112 ms)
      ✓ should handle search query (113 ms)
      ✓ should return empty products array for non-existent category (109 ms)
    GET /api/products/:id
      ✓ should return specific product by valid ID (112 ms)
      ✓ should handle non-existent product ID (114 ms)
      ✓ should handle invalid product ID format (117 ms)
      ✓ should return correct product data for each Queen Bee product (114 ms)
    GET /api/products/search/suggestions
      ✓ should return search suggestions for valid query (114 ms)
      ✓ should return empty suggestions for too short query (109 ms)
      ✓ should handle missing query parameter gracefully (109 ms)
    GET /api/products/category/:category
      ✓ should return products for valid category (113 ms)
      ✓ should return empty array for non-existent category (112 ms)
    POST /api/products (Admin functionality)
      ✓ should create new product with valid data (121 ms)
      ✓ should return 400 for missing required fields (110 ms)
      ✓ should return 400 for invalid price (109 ms)
    Stock Management Endpoints
      ✓ should check stock for existing product (110 ms)
      ✓ should get low stock products (111 ms)
    Performance Tests
      ✓ should respond within acceptable time limits (111 ms)
      ✓ should handle concurrent requests (136 ms)
    Real Data Validation
      ✓ should have correct Queen Bee Candles product data (111 ms)
      ✓ should have reasonable stock quantities (111 ms)

  console.log
    🧪 Loading TEST environment for Jest tests

      at tests/setup/env.js:10:11

PASS tests/api/basic.test.js
  Basic App Setup
    ✓ should respond to health check (132 ms)
    ✓ should respond to root route (111 ms)

Test Suites: 5 passed, 5 total
Tests:       99 passed, 99 total
Snapshots:   0 total
Time:        16.946 s, estimated 18 s
Ran all test suites.

Jest has detected the following 1 open handle potentially keeping Jest from exiting:

  ●  TCPWRAP

      324 |     it('should handle concurrent requests', async () => {
      325 |       const requests = Array(3).fill(null).map(() => 
    > 326 |         request(app).get('/api/products').expect(200)
          |                      ^
      327 |       );
      328 |
      329 |       const responses = await Promise.all(requests);

      at Test.serverAddress (node_modules/supertest/lib/test.js:48:35)
      at new Test (node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (node_modules/supertest/index.js:43:18)
      at tests/api/products.test.js:326:22
          at Array.map (<anonymous>)
      at Object.<anonymous> (tests/api/products.test.js:325:44)

